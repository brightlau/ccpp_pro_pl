#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

/*
位操作：
在C语言中，位操作符（如移位、与、或）常用于底层编程、硬件操作、数据压缩和性能优化等场景

一、移位操作符（<< 和 >>）
（1）左移（<<）
 作用：将二进制位向左移动，右侧补0。等价于乘以2的幂
 应用场景：
 - 快速乘法：替代乘2的幂的运算，提升性能
 - 组合数据：将多个字段（如颜色值）合并到一个整数中

（2）右移（>>）
 作用：将二进制位向右移动。无符号数左侧补0（逻辑右移），有符号数通常补符号位（算术右移）
 应用场景：
 - 快速除法：替代除以2的幂的运算
 - 提取数据：从组合值中分离出特定字段

二、位与操作符（&） 
 作用：按位与操作，用于掩码操作和清除特定位
 应用场景：
 - 检查特定位：判断某一位是否为1
 - 清除特定位：将某些位设为0

三、位或操作符（|）
 作用：按位或操作，用于设置特定位
 应用场景：
 - 设置特定位：将某些位设为1
 - 合并多个选项：组合多个标志位

四、综合应用场景
 硬件寄存器操作：在嵌入式开发中，常用位操作配置硬件寄存器
 权限管理系统：用位掩码表示用户权限
 数据压缩与解压：将多个布尔值存储在一个字节中

五、注意事项
 优先级问题：移位操作符优先级较低，需注意加括号
 符号位处理：有符号数右移结果依赖编译器（通常是算术右移）
 类型限制：位操作仅适用于整数类型（如int、uint32_t） 

通过合理使用位操作，可以显著提升代码效率和空间利用率，尤其在嵌入式系统和底层开发中至关重要 
*/
int bits_oper(void) { 

  // 左移（<<）
  int a1 = 3;                              // 快速计算3 * 8 <=> 3 * 2^3（即3 << 3） 
  int result1 = a1 << 3;                   // 结果为 24 
  uint8_t r = 0x12, g = 0x34, b = 0x56;    // 组合RGB颜色（红、绿、蓝各8位）
  uint32_t rgb = (r << 16) | (g << 8) | b; // 结果为 0x00123456

  // 右移（>>）
  int a2 = 16;                             // 快速计算16 / 4 <=> 16 / 2^2（即16 >> 2）
  int result2 = a2 >> 2;                   // 结果为 4
  uint32_t rgb2 = 0x00123456;              // 提取RGB中的红色分量
  uint8_t r2 = (rgb2 >> 16) & 0xFF;        // 结果为 0x12   & 0xFF <=>  & 0x0000 0000 1111 1111

  // 位与操作符（&） 
  int num = 5;                // 0x 0000 0000 0000 0000 0000 0000 0000 0101 & 0x 0000 0000 0000 0000 0000 0000 0000 0001
  if (num & 1) {              // 检查最低位是否为1（判断奇偶性）
    printf("奇数\n");  // 输出：奇数
  }
  uint8_t flags = 0b10101010; // 清除最高位（假设8位数）
  flags = flags & 0b01111111; // 结果为0b00101010

  // 位或操作符（|）
  uint8_t flags1 = 0b00000000; // 设置第三位为1（从0开始计数）
  flags1 |= (1 << 2);          // 结果为0b00000100
  #define READ_MODE  0x01      // 合并文件打开选项（如O_RDWR | O_CREAT）
  #define WRITE_MODE 0x02
  int mode = READ_MODE | WRITE_MODE; // 0x03（读写模式）0b0011

  // 综合应用场景
  volatile uint32_t *reg = (uint32_t*)0x40000000;  
  *reg |= (1 << 3);                                // 设置寄存器的第3位为1，其他位不变
  *reg &= ~(1 << 5);                               // 清除寄存器的第5位

  #define PERM_READ   0x01
  #define PERM_WRITE  0x02
  #define PERM_EXEC   0x04
  uint8_t user_permissions = PERM_READ | PERM_WRITE; // 赋予读和写权限

  int has_red = 0x12, has_green = 0x34, has_blue = 0x56;
  uint8_t flags2 = 0;
  flags |= (has_red << 0);    // 第0位表示红色
  flags |= (has_green << 1);  // 第1位表示绿色
  flags |= (has_blue << 2);   // 第2位表示蓝色

  int a = 1 << 3 + 1; // 等价于1 << (3+1)=16，而非(1<<3)+1=9

  return 0; 
}

int main(void) {

  // 位操作
  bits_oper();

  return 0;
}